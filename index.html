<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StudySphere - Collaborative Learning</title>
  <!-- <link rel="stylesheet" href="styles.css"> -->
   <style>
    /* General Styles */
body {
  font-family: 'Arial', sans-serif;
  margin: 0;
  padding: 0;
  background-color: #f4f4f9;
  color: #333;
}

nav {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px 10%;
  background-color: #fff;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

nav .logo {
  font-size: 24px;
  font-weight: bold;
  color: #4a90e2;
}

nav .nav-links {
  list-style: none;
  display: flex;
  gap: 20px;
}

nav .nav-links a {
  text-decoration: none;
  color: #333;
  font-weight: 500;
}

.cta-button {
  background-color: #4a90e2;
  color: #fff;
  border: none;
  padding: 10px 20px;
  border-radius: 5px;
  cursor: pointer;
  font-size: 16px;
}

.cta-button:hover {
  background-color: #357abd;
}

/* Hero Section */
.hero {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 50px 10%;
  background-color: #fff;
}

.hero-content h1 {
  font-size: 48px;
  margin-bottom: 20px;
  color: #333;
}

.hero-content p {
  font-size: 18px;
  margin-bottom: 30px;
  color: #666;
}

/* Hero Section */
  .hero {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 50px 10%;
    background-color: #fff;
  }
  
  .hero-content h1 {
    font-size: 48px;
    margin-bottom: 20px;
    color: #333;
  }
  
  .hero-content p {
    font-size: 18px;
    margin-bottom: 30px;
    color: #666;
  }
  
  .hero-image img {
    max-width: 30%;
    height: 30%;
    animation: float 3s ease-in-out infinite;
    position: relative;
    top: 10%; 
    left: 55%;
  }
  
  @keyframes float {
    0%, 100% {
      transform: translateY(0);
    }
    50% {
      transform: translateY(-20px);
    }
  }

@keyframes float {
  0%, 100% {
    transform: translateY(0);
  }
  50% {
    transform: translateY(-20px);
  }
}

/* Features Section */
.features {
  padding: 50px 10%;
  text-align: center;
  background-color: #f4f4f9;
}

.features h2 {
  font-size: 36px;
  margin-bottom: 40px;
  color: #333;
}

.feature-cards {
  display: flex;
  justify-content: space-around;
  gap: 20px;
}

.card {
  background-color: #fff;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  width: 30%;
  transition: transform 0.3s ease;
}

.card:hover {
  transform: translateY(-10px);
}

.card i {
  font-size: 40px;
  color: #4a90e2;
  margin-bottom: 20px;
}

.card h3 {
  font-size: 24px;
  margin-bottom: 10px;
  color: #333;
}

.card p {
  font-size: 16px;
  color: #666;
}

/* Create Group Section - Updated Styles */
.create-group {
  padding: 50px 10%;
  background-color: #fff;
  text-align: center;
}

.create-group h2 {
  font-size: 36px;
  margin-bottom: 40px;
  color: #333;
}

.create-group form {
  max-width: 600px;
  margin: 0 auto;
  padding: 20px;
  background-color: #f9f9f9;
  border-radius: 10px;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.create-group input,
.create-group textarea {
  width: 100%;
  padding: 12px;
  margin-bottom: 15px;
  border: 1px solid #ddd;
  border-radius: 5px;
  font-size: 16px;
  box-sizing: border-box;
  resize: vertical;
}

.create-group textarea {
  height: 100px;
}

.create-group button {
  width: 100%;
  padding: 12px;
  background-color: #4a90e2;
  color: #fff;
  border: none;
  border-radius: 5px;
  font-size: 16px;
  cursor: pointer;
  transition: background-color 0.3s ease;
}

.create-group button:hover {
  background-color: #357abd;
}

/* Study Groups Section */
.study-groups {
  padding: 50px 10%;
  background-color: #f4f4f9;
}

.study-groups h2 {
  font-size: 36px;
  text-align: center;
  margin-bottom: 40px;
  color: #333;
}

/* Group Name Title in Details Modal */
#groupNameTitle {
  color: #333; /* Darker color */
  text-transform: uppercase; /* Uppercase text */
  font-size: 24px; /* Optional: Adjust font size */
  margin-bottom: 20px; /* Optional: Add spacing */
}

.group-list {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  justify-content: center;
}

.group-card {
  background-color: #fff;
  padding: 20px;
  border-radius: 10px;
  text-align: center;
  width: 30%;
  transition: transform 0.3s ease;
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

.group-card:hover {
  transform: translateY(-10px);
}

.group-card h3 {
  font-size: 24px;
  margin-bottom: 10px;
  color: #333;
}

.group-card p {
  font-size: 16px;
  color: #666;
  margin-bottom: 20px;
}

.join-button,
.details-button {
  background-color: #4a90e2;
  color: #fff;
  border: none;
  padding: 10px 20px;
  border-radius: 5px;
  cursor: pointer;
  margin: 5px;
}

.join-button:hover,
.details-button:hover {
  background-color: #357abd;
}

/* Progress Section */
.progress {
  padding: 50px 10%;
  text-align: center;
  background-color: #fff;
}

.progress-bar {
  width: 100%;
  height: 20px;
  background-color: #ddd;
  border-radius: 10px;
  margin: 20px 0;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  background-color: #4a90e2;
  border-radius: 10px;
  transition: width 0.5s ease;
}

/* Footer */
footer {
  text-align: center;
  padding: 20px;
  background-color: #fff;
  border-top: 1px solid #ddd;
}

/* ADDED */


/* Modal Tabs */
.modal-tabs {
  display: flex;
  justify-content: center;
  margin-bottom: 20px;
}

.modal-tabs button {
  background-color: #ddd;
  border: none;
  padding: 10px 20px;
  cursor: pointer;
  font-size: 16px;
}

.modal-tabs button.active {
  background-color: #4a90e2;
  color: #fff;
}

.form-content {
  display: none;
}

.form-content.active {
  display: block;
}

/* Popup */
/* Modal Styles */
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(0, 0, 0, 0.5);
  justify-content: center;
  align-items: center;
}

.modal-content {
  background-color: #fff;
  padding: 20px;
  border-radius: 10px;
  width: 400px;
  text-align: center;
  position: relative;
}

.modal-content .close {
  position: absolute;
  top: 10px;
  right: 10px;
  font-size: 24px;
  cursor: pointer;
}

.modal-content h2 {
  margin-bottom: 20px;
  color: #333;
}

.modal-content input,
.modal-content textarea {
  width: 100%;
  padding: 5px;
  margin-bottom: 10px;
  border: 1px solid #ddd;
  border-radius: 5px;
}

.modal-content button.secondary {
  background-color: #6c757d;
  margin-top: 10px;
}

.modal-content button.secondary:hover {
  background-color: #5a6268;
}

/* Joined Popup */
.popup {
  display: none;
  position: fixed;
  bottom: 20px;
  right: 20px;
  background-color: #4a90e2;
  color: white;
  padding: 15px 25px;
  border-radius: 5px;
  z-index: 1000;
}

/* From Uiverse.io by vinodjangid07 */
.Btn {
  display: flex;
  align-items: center;
  justify-content: flex-start;
  width: 45px;
  height: 45px;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  position: relative;
  overflow: hidden;
  transition-duration: .3s;
  box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.199);
  background-color: rgb(255, 65, 65);
}

/* plus sign */
.sign {
  width: 100%;
  transition-duration: .3s;
  display: flex;
  align-items: center;
  justify-content: center;
}

.sign svg {
  width: 17px;
}

.sign svg path {
  fill: white;
}
/* text */
.text {
  position: absolute;
  right: 0%;
  width: 0%;
  opacity: 0;
  color: white;
  font-size: 1.5em;
  font-weight: 600;
  transition-duration: .3s;
  padding-bottom: 80%;
}
/* hover effect on button width */
.Btn:hover {
  width: 125px;
  border-radius: 40px;
  transition-duration: .3s;
}

.Btn:hover .sign {
  width: 30%;
  transition-duration: .3s;
  padding-left: 20px;
}
/* hover effect button's text */
.Btn:hover .text {
  opacity: 1;
  width: 70%;
  transition-duration: .3s;
  padding-right: 10px;
}
/* button click effect*/
.Btn:active {
  transform: translate(2px ,2px);
}
   </style>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  
   <!-- Firebase SDK - Using modular version instead of compat -->
   <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
   <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
   <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
   
   <!-- Firebase Initialization -->
   <script>
     // Inline Firebase initialization to avoid any loading issues
     console.log('Initializing Firebase...');
     
     // Your Firebase configuration object
     const firebaseConfig = {
       apiKey: "AIzaSyDI5XxL5DtKE7Esthsal37p6PCGe_C4V60",
       authDomain: "hackathaon-6c0d8.firebaseapp.com",
       projectId: "hackathaon-6c0d8",
       storageBucket: "hackathaon-6c0d8.appspot.com",
       messagingSenderId: "187472374442",
       appId: "1:187472374442:web:3dd91baf9702782e5e7ed3",
       measurementId: "G-C5D5TR0DBF"
     };
     
     // Initialize Firebase
     if (typeof firebase !== 'undefined') {
       // Check if Firebase is already initialized
       if (!firebase.apps || !firebase.apps.length) {
         firebase.initializeApp(firebaseConfig);
       }
       
       // Get auth and firestore instances
       const auth = firebase.auth();
       const db = firebase.firestore();
       
       // Make them available globally
       window.auth = auth;
       window.db = db;
       
       console.log('Firebase initialized successfully.');
     } else {
       console.error('Firebase SDK not loaded! Make sure your script tags are in the correct order.');
     }
   </script>
</head>
<body>
  <!-- Navigation Bar -->
  <nav>
    <div class="logo">StudySphere</div>
    <ul class="nav-links">
      <li><a href="#home">Home</a></li>
      <li><a href="#features">Features</a></li>
      <li><a href="#create-group">Create Group</a></li>
      <li><a href="#groups">Study Groups</a></li>
    </ul>
    <button class="cta-button" id="openModal">Sign Up</button>
    <button class="Btn" id="signOutButton" style="display: none;">
      <div class="sign">
        <svg viewBox="0 0 512 512">
          <path d="M377.9 105.9L500.7 228.7c7.2 7.2 11.3 17.1 11.3 27.3s-4.1 20.1-11.3 27.3L377.9 406.1c-6.4 6.4-15 9.9-24 9.9c-18.7 0-33.9-15.2-33.9-33.9l0-62.1-128 0c-17.7 0-32-14.3-32-32l0-64c0-17.7 14.3-32 32-32l128 0 0-62.1c0-18.7 15.2-33.9 33.9-33.9c9 0 17.6 3.6 24 9.9zM160 96L96 96c-17.7 0-32 14.3-32 32l0 256c0 17.7 14.3 32 32 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-64 0c-53 0-96-43-96-96L0 128C0 75 43 32 96 32l64 0c17.7 0 32 14.3 32 32s-14.3 32-32 32z"></path>
        </svg>
      </div>
      <!-- <div class="text">Logout</div> -->
    </button>
  </nav>

  <!-- Hero Section -->
  <section id="home" class="hero">
    <div class="hero-content">
      <h1>Collaborate, Learn, Succeed</h1>
      <p>Join study groups, set goals, and track progress with peers.</p>
      <button class="cta-button" id="getStarted">Get Started</button>
    </div>
    <div class="hero-image">
      <img src="./assets/images/study-group.jpg" alt="Study Group">
    </div>
  </section>

  <!-- Features Section -->
  <section id="features" class="features">
    <h2>Features</h2>
    <div class="feature-cards">
      <div class="card">
        <i class="fas fa-users"></i>
        <h3>Create Study Groups</h3>
        <p>Form groups with peers and collaborate effectively.</p>
      </div>
      <div class="card">
        <i class="fas fa-tasks"></i>
        <h3>Set Goals & Tasks</h3>
        <p>Assign tasks and track progress together.</p>
      </div>
      <div class="card">
        <i class="fas fa-chart-line"></i>
        <h3>Track Progress</h3>
        <p>Visualize your progress with charts and analytics.</p>
      </div>
    </div>
  </section>

  <!-- Create Group Section
  <section id="create-group" class="create-group">
    <h2>Create a Study Group</h2>
    <form id="createGroupForm">
      <input type="text" id="groupName" placeholder="Group Name" required>
      <input type="text" id="groupFocus" placeholder="Focus Area (e.g., Math, Science)" required>
      <textarea id="groupGoalsInput" placeholder="Enter goals (one per line)" required></textarea>
      <textarea id="groupTasksInput" placeholder="Enter tasks (one per line)" required></textarea>
      <button type="submit" class="cta-button">Create Group</button>
    </form>
  </section> -->

  <!-- Create Group Section -->
<section id="create-group" class="create-group">
  <h2>Create a Study Group</h2>
  <form id="createGroupForm">
    <input type="text" id="groupName" placeholder="Group Name" required>
    <input type="text" id="groupFocus" placeholder="Focus Area (e.g., Math, Science)" required>
    <textarea id="groupGoalsInput" placeholder="Enter goals (one per line)" required></textarea>
    <textarea id="groupTasksInput" placeholder="Enter tasks (one per line)" required></textarea>
    <button type="submit" class="cta-button">Create Group</button>
  </form>
</section>

  <!-- Study Groups Section -->
  <section id="groups" class="study-groups">
    <h2>Study Groups</h2>
    <div class="group-list" id="groupList">
      <!-- Groups will be dynamically added here -->
    </div>
  </section>

  <!-- Footer -->
  <footer>
    <p>&copy; 2023 StudySphere. All rights reserved.</p>
  </footer>

  <!-- Login/Signup Modal -->
  <div id="loginModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <div class="modal-tabs">
        <button id="loginTab" class="active">Login</button>
        <button id="signupTab">Sign Up</button>
      </div>
      <div id="loginForm" class="form-content active">
        <h2>Login</h2>
        <form id="authLoginForm">
          <input type="email" id="loginEmail" placeholder="Email" required>
          <input type="password" id="loginPassword" placeholder="Password" required>
          <button type="submit" class="cta-button">Login</button>
        </form>
      </div>
      <div id="signupForm" class="form-content">
        <h2>Sign Up</h2>
        <form id="authSignupForm">
          <input type="text" id="signupName" placeholder="Name" required>
          <input type="email" id="signupEmail" placeholder="Email" required>
          <input type="password" id="signupPassword" placeholder="Password" required>
          <input type="password" id="confirmPassword" placeholder="Confirm Password" required>
          <button type="submit" class="cta-button">Sign Up</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Group Details Modal -->
  <div id="groupDetailsModal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <h2 id="groupNameTitle"></h2>
      <h3>Goals</h3>
      <ul id="groupGoals"></ul>
      <h3>Tasks</h3>
      <ul id="groupTasks"></ul>
      <h3>Progress</h3>
      <div class="progress-bar">
        <div class="progress-fill" id="groupProgressFill"></div>
      </div>
      <p id="groupProgressText"></p>
    </div>
  </div>

  <!-- Joined Popup -->
  <div id="joinedPopup" class="popup">
    <p>Joined!</p>
  </div>

  <!-- Your JavaScript content -->
  <script>
    // Wait for DOM to be fully loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Array to store created study groups
      let studyGroups = [];

      // Function to render study groups
      function renderStudyGroups() {
        const groupList = document.getElementById('groupList');
        groupList.innerHTML = ''; // Clear existing groups

        studyGroups.forEach((group, index) => {
          const groupCard = document.createElement('div');
          groupCard.className = 'group-card';
          groupCard.innerHTML = `
            <h3>${group.name}</h3>
            <p>Focus: ${group.focus}</p>
            <p>Created by: ${group.ownerName}</p>
            <button class="join-button" data-index="${index}">Join</button>
            <button class="details-button" data-index="${index}">Details</button>
          `;
          groupList.appendChild(groupCard);
        });

        // Add event listeners to the "Join" buttons
        document.querySelectorAll('.join-button').forEach(button => {
          button.addEventListener('click', (e) => {
            const groupIndex = e.target.getAttribute('data-index');
            const group = studyGroups[groupIndex];
            joinGroup(group);
          });
        });

        // Add event listeners to the "Details" buttons
        document.querySelectorAll('.details-button').forEach(button => {
          button.addEventListener('click', (e) => {
            const groupIndex = e.target.getAttribute('data-index');
            const group = studyGroups[groupIndex];
            showGroupDetails(group);
          });
        });
      }

      // Function to show "Joined" popup
      function showJoinedPopup() {
        const popup = document.getElementById('joinedPopup');
        popup.style.display = 'block';
        setTimeout(() => {
          popup.style.display = 'none';
        }, 2000); // Hide after 2 seconds
      }

      // Function to show group details in a modal
      function showGroupDetails(group) {
        document.getElementById('groupNameTitle').textContent = group.name;

        // Display goals with checkboxes
        const goalsList = document.getElementById('groupGoals');
        goalsList.innerHTML = group.goals
          .map(
            (goal) => `
            <li>
              <input type="checkbox" id="goal-${group.goals.indexOf(goal)}" onchange="updateProgress()">
              <label for="goal-${group.goals.indexOf(goal)}">${goal}</label>
            </li>
          `
          )
          .join('');

        // Display tasks with checkboxes
        const tasksList = document.getElementById('groupTasks');
        tasksList.innerHTML = group.tasks
          .map(
            (task) => `
            <li>
              <input type="checkbox" id="task-${group.tasks.indexOf(task)}" onchange="updateProgress()">
              <label for="task-${group.tasks.indexOf(task)}">${task}</label>
            </li>
          `
          )
          .join('');

        // Initialize progress bar
        updateProgress();

        // Show the modal
        document.getElementById('groupDetailsModal').style.display = 'flex';
      }

      // Function to update progress bar
      window.updateProgress = function() {
        const goals = document.querySelectorAll('#groupGoals input[type="checkbox"]');
        const tasks = document.querySelectorAll('#groupTasks input[type="checkbox"]');
        const totalItems = goals.length + tasks.length;

        let completedItems = 0;
        goals.forEach((checkbox) => {
          if (checkbox.checked) completedItems++;
        });
        tasks.forEach((checkbox) => {
          if (checkbox.checked) completedItems++;
        });

        const progress = totalItems > 0 ? Math.round((completedItems / totalItems) * 100) : 0;
        const progressFill = document.getElementById('groupProgressFill');
        const progressText = document.getElementById('groupProgressText');

        progressFill.style.width = `${progress}%`;
        progressText.textContent = `${progress}% completed`;
      };

      // Function to join a group
      function joinGroup(group) {
        const user = window.auth.currentUser;
        if (!user) {
          // Show login/signup modal
          document.getElementById('loginModal').style.display = 'flex';
          document.getElementById('loginTab').click(); // Default to login form
          return;
        }

        // Add user to the group (this can be expanded to update the database)
        console.log(`User ${user.uid} joined group ${group.name}`);
        showJoinedPopup();
      }

      // Switch between Login and Signup forms
      document.getElementById('loginTab').addEventListener('click', () => {
        document.getElementById('loginTab').classList.add('active');
        document.getElementById('signupTab').classList.remove('active');
        document.getElementById('loginForm').classList.add('active');
        document.getElementById('signupForm').classList.remove('active');
      });

      document.getElementById('signupTab').addEventListener('click', () => {
        document.getElementById('signupTab').classList.add('active');
        document.getElementById('loginTab').classList.remove('active');
        document.getElementById('signupForm').classList.add('active');
        document.getElementById('loginForm').classList.remove('active');
      });

      // Open Login/Signup Modal
      document.getElementById('getStarted').addEventListener('click', () => {
        document.getElementById('loginModal').style.display = 'flex';
        document.getElementById('loginTab').click(); // Default to login form
      });

      document.getElementById('openModal').addEventListener('click', () => {
        document.getElementById('loginModal').style.display = 'flex';
        document.getElementById('loginTab').click(); // Default to login form
      });

      // Close Modal
      document.querySelectorAll('.close').forEach(closeBtn => {
        closeBtn.addEventListener('click', () => {
          document.querySelectorAll('.modal').forEach(modal => {
            modal.style.display = 'none';
          });
        });
      });

      // Close Modal when clicking outside
      window.addEventListener('click', (event) => {
        if (event.target.classList.contains('modal')) {
          event.target.style.display = 'none';
        }
      });

      // Create Group Form Submission
      document.getElementById('createGroupForm').addEventListener('submit', (e) => {
        e.preventDefault();
        
        // Check if user is logged in
        const user = window.auth.currentUser;
        if (!user) {
          // Show login/signup modal
          document.getElementById('loginModal').style.display = 'flex';
          document.getElementById('loginTab').click(); // Default to login form

          // Retain form data
          const groupName = document.getElementById('groupName').value;
          const groupFocus = document.getElementById('groupFocus').value;
          const groupGoals = document.getElementById('groupGoalsInput').value;
          const groupTasks = document.getElementById('groupTasksInput').value;

          // Listen for successful login/signup
          const authStateListener = window.auth.onAuthStateChanged((user) => {
            if (user) {
              // User logged in, restore form data
              document.getElementById('groupName').value = groupName;
              document.getElementById('groupFocus').value = groupFocus;
              document.getElementById('groupGoalsInput').value = groupGoals;
              document.getElementById('groupTasksInput').value = groupTasks;

              // Remove the listener
              authStateListener();

              // Submit the form again
              document.getElementById('createGroupForm').dispatchEvent(new Event('submit'));
            }
          });
          return;
        }

        const groupName = document.getElementById('groupName').value;
        const groupFocus = document.getElementById('groupFocus').value;
        const groupGoals = document.getElementById('groupGoalsInput').value.split('\n').filter(goal => goal.trim() !== '');
        const groupTasks = document.getElementById('groupTasksInput').value.split('\n').filter(task => task.trim() !== '');

        // Add the new group to the database
        const groupData = {
          name: groupName,
          focus: groupFocus,
          goals: groupGoals,
          tasks: groupTasks,
          ownerId: user.uid,
          ownerName: user.displayName || user.email // Use displayName if available, otherwise email
        };

        window.db.collection('groups').add(groupData)
          .then((docRef) => {
            console.log('Group created with ID:', docRef.id);
            // Add the new group to the local array
            studyGroups.push(groupData);
            // Render the updated list of groups
            renderStudyGroups();
            // Reset the form
            document.getElementById('createGroupForm').reset();
          })
          .catch((error) => {
            console.error('Error adding group:', error);
            alert('Error creating group. Please try again.');
          });
      });

      // Fetch groups from the database
      function fetchGroups() {
        window.db.collection('groups').get()
          .then((querySnapshot) => {
            studyGroups = querySnapshot.docs.map(doc => doc.data());
            renderStudyGroups();
          })
          .catch((error) => {
            console.error('Error fetching groups:', error);
          });
      }

      // Check if Firebase auth is available
      if (typeof window.auth === 'undefined' || typeof window.db === 'undefined') {
        console.error('Firebase auth or db is not initialized properly');
        alert('Firebase authentication is not available. Please check your Firebase configuration.');
      } else {
        console.log('Firebase auth and db are available');
        
        // Sign Up
        document.getElementById('authSignupForm').addEventListener('submit', (e) => {
          e.preventDefault();
          const name = document.getElementById('signupName').value;
          const email = document.getElementById('signupEmail').value;
          const password = document.getElementById('signupPassword').value;
          const confirmPassword = document.getElementById('confirmPassword').value;
          
          // Check if passwords match
          if (password !== confirmPassword) {
            alert('Passwords do not match!');
            return;
          }
          
          console.log('Attempting to create user with email:', email);
          
          // Use a try-catch block for better error handling
          try {
            window.auth.createUserWithEmailAndPassword(email, password)
              .then((userCredential) => {
                // Signed up successfully
                const user = userCredential.user;
                console.log('User created successfully:', user.uid);
                
                // Store additional user information in Firestore
                return window.db.collection('users').doc(user.uid).set({
                  name: name,
                  email: email,
                  createdAt: new Date()
                });
              })
              .then(() => {
                console.log('User data stored in Firestore');
                alert('User signed up successfully!');
                document.getElementById('loginModal').style.display = 'none';
              })
              .catch((error) => {
                console.error('Error signing up:', error);
                
                // More specific error messages
                let errorMessage = error.message;
                if (error.code === 'auth/email-already-in-use') {
                  errorMessage = 'This email is already registered. Please use a different email or try logging in.';
                } else if (error.code === 'auth/invalid-email') {
                  errorMessage = 'Please enter a valid email address.';
                } else if (error.code === 'auth/weak-password') {
                  errorMessage = 'Password is too weak. Please use a stronger password.';
                } else if (error.code === 'auth/configuration-not-found') {
                  errorMessage = 'Authentication is not properly configured. Please check your Firebase project settings.';
                }
                
                alert(`Error signing up: ${errorMessage}`);
              });
          } catch (error) {
            console.error('Exception during signup:', error);
            alert(`Exception during signup: ${error.message}`);
          }
        });

        // Login
        document.getElementById('authLoginForm').addEventListener('submit', (e) => {
          e.preventDefault();
          const email = document.getElementById('loginEmail').value;
          const password = document.getElementById('loginPassword').value;

          console.log('Attempting to sign in with email:', email);
          
          try {
            window.auth.signInWithEmailAndPassword(email, password)
              .then((userCredential) => {
                // Logged in successfully
                console.log('User logged in successfully:', userCredential.user.uid);
                alert('User logged in successfully!');
                document.getElementById('loginModal').style.display = 'none';
              })
              .catch((error) => {
                console.error('Error logging in:', error);
                
                // More specific error messages
                let errorMessage = error.message;
                if (error.code === 'auth/user-not-found') {
                  errorMessage = 'No user found with this email. Please check your email or sign up.';
                } else if (error.code === 'auth/wrong-password') {
                  errorMessage = 'Incorrect password. Please try again.';
                } else if (error.code === 'auth/invalid-email') {
                  errorMessage = 'Please enter a valid email address.';
                } else if (error.code === 'auth/configuration-not-found') {
                  errorMessage = 'Authentication is not properly configured. Please check your Firebase project settings.';
                }
                
                alert(`Error logging in: ${errorMessage}`);
              });
          } catch (error) {
            console.error('Exception during login:', error);
            alert(`Exception during login: ${error.message}`);
          }
        });
        
        // Auth state change listener
        window.auth.onAuthStateChanged((user) => {
          if (user) {
            // User is signed in
            console.log('User is signed in:', user.uid);
            document.getElementById('openModal').style.display = 'none';
            document.getElementById('signOutButton').style.display = 'block';
          } else {
            // User is signed out
            console.log('User is signed out');
            document.getElementById('openModal').style.display = 'block';
            document.getElementById('signOutButton').style.display = 'none';
          }
        });

        // Sign Out
        document.getElementById('signOutButton').addEventListener('click', () => {
          window.auth.signOut().then(() => {
            console.log('User signed out successfully.');
            alert('User signed out successfully!');
          }).catch((error) => {
            console.error('Error signing out:', error);
            alert(`Error signing out: ${error.message}`);
          });
        });

        // Fetch groups from the database on load
        fetchGroups();
      }
    });
  </script>
</body>
</html>